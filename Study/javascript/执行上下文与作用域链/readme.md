#### 执行上下文

**javascript引擎遇到js代码会为其创建一个特殊的环境，处理代码的转换和执行，这个环境就叫做执行上下文**


执行上下文分为全局执行上下文和函数执行上下文，区别在于全局执行上下文只有一个，函数执行上下文在每次调用函数时候会创建一个新的函数执行上下文。

执行上下文的组成代码示例
```js
const ExecutionContextObj = {
    VO: window, //变量对象
    ScopeChain: {} // 作用域链
    this: window
}
```
#### 执行上下文是如何被创建的？

执行上下文的创建分为两个阶段：

1: 创建阶段
2: 执行阶段


##### 创建阶段

创建阶段分三个步骤来定义和设置执行上下文对象的属性：

1: 创建变量对象（VO）
2: 创建作用域链
3: 设置 this关键字的值


每个上下文都有一个关联的变量对象，而这个上下文中定义的所有变量和函数都存在于这个对象上，**函数上下文创建的是类数组对象，称为arguments对象，包含传入函数的所有参数**。


作用域链：上下文的代码在执行的时候，会创建变量对象的一个作用域链，这个作用域链决定了各级上下文的代码在访问变量和函数时的顺序。


this指向：作用域查找之后就是创建阶段的最后一步是设置this关键字的值。

JavaScript中this关键字指的是执行上下文所属的作用域。

一旦作用域链被创建，JS引擎就会初始化this关键字的值。


##### 执行阶段
执行上下文创建阶段之后就是执行阶段了，在这一阶段代码执行真正开始。

到目前为止，VO包含的变量值为undefined，如果这时就运行代码，肯定会报错，我们无法执行未定义的变量。

在执行阶段，JavaScript引擎会再次读取执行上下文，并用变量的实际值更新VO。编译器再把代码编译为计算机可执行的字节码后执行。


#### JavaScript执行栈
执行栈又称调用栈，记录了脚本整个生命周期中生成的执行上下文。

JavaScript是单线程语言，也就是说它只能在同一时间执行一项任务。因此，其他的操作、函数和事件发生时，执行上下文也会被创建。由于单线程的特性，一个堆叠了执行上下文的栈就会被创建，称为执行栈



https://www.freecodecamp.org/chinese/news/execution-context-how-javascript-works-behind-the-scenes/




